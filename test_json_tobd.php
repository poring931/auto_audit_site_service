<?
header('Content-Type: text/html; charset=utf-8');
error_reporting(E_ALL);
ini_set('display_errors', 1);

$audit_JSON=
'{"url":"https://lightup.su/","page_404":"https://lightup.su/sadasdsadasd/asdasdsad/","page_sitemap":"https://lightup.su/sitemap.xml","page_robots":"https://lightup.su/robots.txt","crawl__links":["https://lightup.su/","https://lightup.su/catalog/","https://lightup.su/catalog/ulichnye-svetilniki/","https://lightup.su/catalog/promyshlennye-svetilniki/","https://lightup.su/catalog/ofisnye-svetilniki/","https://lightup.su/catalog/fitosvetilniki/","https://lightup.su/actions/","https://lightup.su/about/","https://lightup.su/about/projects/","https://lightup.su/about/news/","https://lightup.su/about/protocols/","https://lightup.su/about/delivery/","https://lightup.su/contacts/","https://lightup.su/about/sogl.php"],"page_without_h1":[],"page_multiply_h1":[],"page_h1__title__is_iqaul":[],"page_copies_description":["0"],"page_without_description":[],"page_with_short__description":["19,https://lightup.su/about/protocols/"],"page_with_long__description":["120,https://lightup.su/catalog/","104,https://lightup.su/actions/","80,https://lightup.su/about/","141,https://lightup.su/about/projects/","93,https://lightup.su/about/news/","19,https://lightup.su/about/protocols/","89,https://lightup.su/contacts/","112,https://lightup.su/about/sogl.php"],"page_copies_title":[""],"page_without_title":[],"page_title__length":["66,https://lightup.su/","84,https://lightup.su/catalog/","76,https://lightup.su/catalog/ulichnye-svetilniki/","72,https://lightup.su/catalog/promyshlennye-svetilniki/","61,https://lightup.su/catalog/ofisnye-svetilniki/","57,https://lightup.su/catalog/fitosvetilniki/","37,https://lightup.su/actions/","21,https://lightup.su/about/","28,https://lightup.su/about/projects/","28,https://lightup.su/about/news/","23,https://lightup.su/about/protocols/","31,https://lightup.su/about/delivery/","56,https://lightup.su/contacts/","64,https://lightup.su/about/sogl.php"],"page__NoindexNofollow":[],"mobile_view_port":"true","favicon":"false","schema_org":{"is_set":"true","Organization":"true","logo":"true","contactPoint":"true","BreadcrumbList":"true","sameAs":"","LocalBusiness":"","WebSite":"","SiteNavigationElement":"","Product":"","FAQPage":""},"yandex__metric":"true","google__metric":"true","words_on_main_page":6682,"array_external__links":["https://impulse.guru/","https://api.whatsapp.com/send?phone=+79011417247"],"array_without_canonical":[],"redirecthttp":"есть","date":"1636910616","redirectwww":"есть (код - 301 https://www.lightup.su/)","firstbyte":"0.092014 c","domainendspay":"29.12.2021","robots":"есть (код - 200 https://lightup.su/robots.txt)","agedomain":"Возраст домена:4.9 Года","rindexphp":"редирект отсутствует","sitemapxml":"есть (код - 200 https://lightup.su/sitemap.xml)","yandexiks":150,"notfoundpage":"есть (код - 404 https://lightup.su/asdasdasd/)","ssl":"SSl-сертификат есть. Дата окончания:  Dec 31 05:36:21 2021 ","w3org":"44"}';



// seoins23_resaudi
// 7bw%u0nD

?>

<?/*
agedomain: "Возраст домена:3.2 Года"
array_external__links: (3) ['https://vk.com/vasabi33', 'https://www.instagram.com/vasabivladimir/', 'http://net-brand.ru/']
array_without_canonical: (19) ['https://vasabi33.ru/personal/?register=yes', 'https://vasabi33.ru/personal/', 'https://vasabi33.ru/menyu/', 'https://vasabi33.ru/o-nas/', 'https://vasabi33.ru/dostavka-i-oplata/', 'https://vasabi33.ru/rekvizity/', 'https://vasabi33.ru/samovyvoz/', 'https://vasabi33.ru/kontakty/', 'https://vasabi33.ru/topMainMenu', 'https://vasabi33.ru/menyu/aktsii/', 'https://vasabi33.ru/menyu/sety/', 'https://vasabi33.ru/menyu/bolshie-rolly/', 'https://vasabi33.ru/menyu/goryachie-rolly/', 'https://vasabi33.ru/menyu/maki-rolly/', 'https://vasabi33.ru/menyu/sushi-i-supy/', 'https://vasabi33.ru/menyu/pitstsa-i-burgery/', 'https://vasabi33.ru/menyu/vok-i-poke/', 'https://vasabi33.ru/menyu/zakuski-i-napitki/', 'https://vasabi33.ru/personal/cart/']
crawl__links: (27) ['https://vasabi33.ru/personal/?register=yes', 'https://vasabi33.ru/personal/', 'https://vasabi33.ru/menyu/', 'https://vasabi33.ru/o-nas/', 'https://vasabi33.ru/dostavka-i-oplata/', 'https://vasabi33.ru/rekvizity/', 'https://vasabi33.ru/samovyvoz/', 'https://vasabi33.ru/kontakty/', 'https://vasabi33.ru/topMainMenu', 'https://vasabi33.ru/menyu/aktsii/', 'https://vasabi33.ru/menyu/sety/', 'https://vasabi33.ru/menyu/bolshie-rolly/', 'https://vasabi33.ru/menyu/goryachie-rolly/', 'https://vasabi33.ru/menyu/maki-rolly/', 'https://vasabi33.ru/menyu/sushi-i-supy/', 'https://vasabi33.ru/menyu/pitstsa-i-burgery/', 'https://vasabi33.ru/menyu/vok-i-poke/', 'https://vasabi33.ru/menyu/zakuski-i-napitki/', 'https://vasabi33.ru/personal/cart/', 'https://vasabi33.ru/menyu/aktsii/set-boston/#top_point', 'https://vasabi33.ru/menyu/aktsii/shef-set/#top_point', 'https://vasabi33.ru/menyu/aktsii/set-chip-i-deyl/#top_point', 'https://vasabi33.ru/menyu/aktsii/love-is/#top_point', 'https://vasabi33.ru/menyu/aktsii/igra-prestolov/#top_point', 'https://vasabi33.ru/menyu/aktsii/set-bonito/#top_point', 'https://vasabi33.ru/menyu/aktsii/set-tsezar/#top_point', 'https://vasabi33.ru/menyu/aktsii/set-kaliforniyskiy/#top_point']
date: "1636307221"
domainendspay: "18.08.2022"
favicon: "true"
firstbyte: "0.127537 c"
google__metric: ""
googlemobile: "32"
googlepc: "82"
gtmetrix: "onload_time => 6723; first_contentful_paint_time => 1910; page_elements => 106; report_url => https://gtmetrix.com/reports/vasabi33.ru/bEzwJ05a/; redirect_duration => 0; first_paint_time => 1910; dom_content_loaded_duration => 17; dom_content_loaded_time => 2048; dom_interactive_time => 2043; page_bytes => 18616636; page_load_time => 6723; html_bytes => 60754; fully_loaded_time => 6921; html_load_time => 952; rum_speed_index => 2311; yslow_score => 70; pagespeed_score => 0; backend_duration => 378; onload_duration => 1; connect_duration => 574; "
mobile_view_port: "true"
notfoundpage: "есть (код - 404 https://vasabi33.ru/asdasdasd/)"
page_404: "https://vasabi33.ru/sadasdsadasd/asdasdsad/"
page__NoindexNofollow: []
page_copies_description: {https://vasabi33.ru/personal/: 'Васаби - https://vasabi33.ru/personal/', https://vasabi33.ru/menyu/: 'Васаби - https://vasabi33.ru/menyu/', https://vasabi33.ru/o-nas/: 'Васаби - https://vasabi33.ru/o-nas/', https://vasabi33.ru/dostavka-i-oplata/: 'Васаби - https://vasabi33.ru/dostavka-i-oplata/', https://vasabi33.ru/rekvizity/: 'Васаби - https://vasabi33.ru/rekvizity/', …}
page_copies_title: {https://vasabi33.ru/personal/: 'Васаби - https://vasabi33.ru/personal/', https://vasabi33.ru/personal/cart/: 'Васаби - https://vasabi33.ru/personal/cart/'}
page_h1__title__is_iqaul: ['https://vasabi33.ru/topMainMenu']
page_multiply_h1: ['https://vasabi33.ru/menyu/']
page_robots: "https://vasabi33.ru/robots.txt"
page_sitemap: "https://vasabi33.ru/sitemap.xml"
page_title__length: (27) ['6,https://vasabi33.ru/personal/?register=yes', '6,https://vasabi33.ru/personal/', '16,https://vasabi33.ru/menyu/', '14,https://vasabi33.ru/o-nas/', '26,https://vasabi33.ru/dostavka-i-oplata/', '18,https://vasabi33.ru/rekvizity/', '18,https://vasabi33.ru/samovyvoz/', '17,https://vasabi33.ru/kontakty/', '0,https://vasabi33.ru/topMainMenu', '34,https://vasabi33.ru/menyu/aktsii/', '37,https://vasabi33.ru/menyu/sety/', '37,https://vasabi33.ru/menyu/bolshie-rolly/', '37,https://vasabi33.ru/menyu/goryachie-rolly/', '40,https://vasabi33.ru/menyu/maki-rolly/', '35,https://vasabi33.ru/menyu/sushi-i-supy/', '39,https://vasabi33.ru/menyu/pitstsa-i-burgery/', '35,https://vasabi33.ru/menyu/vok-i-poke/', '41,https://vasabi33.ru/menyu/zakuski-i-napitki/', '6,https://vasabi33.ru/personal/cart/', '42,https://vasabi33.ru/menyu/aktsii/set-boston/#top_point', '39,https://vasabi33.ru/menyu/aktsii/shef-set/#top_point', '45,https://vasabi33.ru/menyu/aktsii/set-chip-i-deyl/#top_point', '38,https://vasabi33.ru/menyu/aktsii/love-is/#top_point', '46,https://vasabi33.ru/menyu/aktsii/igra-prestolov/#top_point', '42,https://vasabi33.ru/menyu/aktsii/set-bonito/#top_point', '42,https://vasabi33.ru/menyu/aktsii/set-tsezar/#top_point', '50,https://vasabi33.ru/menyu/aktsii/set-kaliforniyskiy/#top_point']
page_with_long__description: (27) ['6,https://vasabi33.ru/personal/?register=yes', '6,https://vasabi33.ru/personal/', '6,https://vasabi33.ru/menyu/', '6,https://vasabi33.ru/o-nas/', '6,https://vasabi33.ru/dostavka-i-oplata/', '6,https://vasabi33.ru/rekvizity/', '6,https://vasabi33.ru/samovyvoz/', '6,https://vasabi33.ru/kontakty/', '0,https://vasabi33.ru/topMainMenu', '57,https://vasabi33.ru/menyu/aktsii/', '60,https://vasabi33.ru/menyu/sety/', '60,https://vasabi33.ru/menyu/bolshie-rolly/', '60,https://vasabi33.ru/menyu/goryachie-rolly/', '63,https://vasabi33.ru/menyu/maki-rolly/', '58,https://vasabi33.ru/menyu/sushi-i-supy/', '62,https://vasabi33.ru/menyu/pitstsa-i-burgery/', '58,https://vasabi33.ru/menyu/vok-i-poke/', '64,https://vasabi33.ru/menyu/zakuski-i-napitki/', '6,https://vasabi33.ru/personal/cart/', '65,https://vasabi33.ru/menyu/aktsii/set-boston/#top_point', '62,https://vasabi33.ru/menyu/aktsii/shef-set/#top_point', '68,https://vasabi33.ru/menyu/aktsii/set-chip-i-deyl/#top_point', '61,https://vasabi33.ru/menyu/aktsii/love-is/#top_point', '69,https://vasabi33.ru/menyu/aktsii/igra-prestolov/#top_point', '65,https://vasabi33.ru/menyu/aktsii/set-bonito/#top_point', '65,https://vasabi33.ru/menyu/aktsii/set-tsezar/#top_point', '73,https://vasabi33.ru/menyu/aktsii/set-kaliforniyskiy/#top_point']
page_with_short__description: (26) ['6,https://vasabi33.ru/personal/?register=yes', '6,https://vasabi33.ru/personal/', '6,https://vasabi33.ru/menyu/', '6,https://vasabi33.ru/o-nas/', '6,https://vasabi33.ru/dostavka-i-oplata/', '6,https://vasabi33.ru/rekvizity/', '6,https://vasabi33.ru/samovyvoz/', '6,https://vasabi33.ru/kontakty/', '0,https://vasabi33.ru/topMainMenu', '57,https://vasabi33.ru/menyu/aktsii/', '60,https://vasabi33.ru/menyu/sety/', '60,https://vasabi33.ru/menyu/bolshie-rolly/', '60,https://vasabi33.ru/menyu/goryachie-rolly/', '63,https://vasabi33.ru/menyu/maki-rolly/', '58,https://vasabi33.ru/menyu/sushi-i-supy/', '62,https://vasabi33.ru/menyu/pitstsa-i-burgery/', '58,https://vasabi33.ru/menyu/vok-i-poke/', '64,https://vasabi33.ru/menyu/zakuski-i-napitki/', '6,https://vasabi33.ru/personal/cart/', '65,https://vasabi33.ru/menyu/aktsii/set-boston/#top_point', '62,https://vasabi33.ru/menyu/aktsii/shef-set/#top_point', '68,https://vasabi33.ru/menyu/aktsii/set-chip-i-deyl/#top_point', '61,https://vasabi33.ru/menyu/aktsii/love-is/#top_point', '69,https://vasabi33.ru/menyu/aktsii/igra-prestolov/#top_point', '65,https://vasabi33.ru/menyu/aktsii/set-bonito/#top_point', '65,https://vasabi33.ru/menyu/aktsii/set-tsezar/#top_point']
page_without_description: ['https://vasabi33.ru/topMainMenu']
page_without_h1: ['https://vasabi33.ru/topMainMenu']
page_without_title: ['https://vasabi33.ru/topMainMenu']
redirecthttp: "есть"
redirectwww: "есть (код - 301 https://www.vasabi33.ru/)"
rindexphp: "редирект отсутствует"
robots: "есть (код - 200 https://vasabi33.ru/robots.txt)"
schema_org: {is_set: '', Organization: '', logo: '', contactPoint: '', BreadcrumbList: '', …}
sitemapxml: "есть (код - 200 https://vasabi33.ru/sitemap.xml)"
ssl: "SSl-сертификат есть. Дата окончания:  Jan 27 22:00:45 2022 "
url: "https://vasabi33.ru/"
w3org: "47"
words_on_main_page: 15775
yandex__metric: "true"
yandexiks: 170
*/?>


<?


//     echo '<pre>';
// var_dump(json_decode($audit_JSON));

//     echo '</pre>';
$arrayJson = json_decode($audit_JSON,true);

echo '<pre>';
// var_dump(json_decode($audit_JSON));
//  var_dump($arrayJson );


echo '</pre>';


// seoins23_resaudi
// 7bw%u0nD
$host = 'localhost';
$db   = 'seoins23_resaudi';
$user = 'seoins23_resaudi';
$pass = '7bw%u0nD';
$charset = 'utf8mb4';

$dsn = "mysql:host=$host;dbname=$db;charset=$charset";
$opt = [
    PDO::ATTR_ERRMODE            => PDO::ERRMODE_EXCEPTION,
    PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
    PDO::ATTR_EMULATE_PREPARES   => false,
];

function quote($str)
{
    return sprintf("'%s'", $str);
}
function pdoSet($items, $arKeys)
{
    $items = $items;//весь массив аудита
    $arKeys = $arKeys;//ключи полученного массива. 1 ключ ssl изменен на ssl_isset. Данные поля соответствуют полям в БД
    $arField = array();

    foreach ($items as $key => $field) {

        if (is_array($field)){
            $field = implode('; ', $field);
        }
        $arField[] = $field; //переводим к общему массиву, в котором будут только строки.
    }

    // $sql = "INSERT INTO audit (" . implode(', ', $arKeys) . ") VALUES ('" . implode("', '", $arField) . ")"; //строка полей
    $sql = "INSERT INTO audit (" . implode(', ', $arKeys) . ") VALUES (" . implode(", ", array_map('quote', $arField)) . ")"; //строка полей
    //  var_dump($sql);
    //   var_dump($items);
    //     var_dump($items);
    return $sql;
}



foreach (array_keys($arrayJson) as $keys){
    if ($keys=='ssl'){
        $keys = 'ssl_isset';//нельзя было сохранить название поля SSL -типа зарезервированное поле
    }
    $arKeys[]= $keys;
}

 var_dump($arrayJson);





try {
//     $pdo = new PDO($dsn, $user, $pass, $opt);
//    $sql = pdoSet($arrayJson, $arKeys);
//     var_dump($sql);
//     $stm = $pdo->prepare($sql);

//     $affectedRowsNumber = $pdo->exec($sql);
//  print $pdo->lastInsertId();
} catch (PDOException $e) {
    die('Проблемы: ' . $e->getMessage());
}

